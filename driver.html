<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>السائق - Brilex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      text-align: center;
      color: #28a745;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background-color: white;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 5px #ccc;
    }
    .invoice {
      background-color: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .btn {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
    }
    .delivered {
      background-color: #28a745;
    }
  </style>
</head>
<body>

  <h1>📋 فواتير الزبائن</h1>
  <div id="clientList"></div>
  <div id="invoiceDetails"></div>

  <script>
    const invoices = JSON.parse(localStorage.getItem("invoices") || "[]");

    function renderClientList() {
      const clientList = document.getElementById("clientList");
      if (invoices.length === 0) {
        clientList.innerHTML = "<p style='color:red; text-align:center;'>⚠️ لا توجد فواتير مسجلة</p>";
        return;
      }

      let html = "<ul>";
      invoices.forEach((inv, i) => {
        html += `<li onclick="showInvoice(${inv.id})">👤 ${inv.clientName} - ${inv.status}</li>`;
      });
      html += "</ul>";
      clientList.innerHTML = html;
    }

    function showInvoice(id) {
      const invoice = invoices.find(i => i.id === id);
      if (!invoice) return;

      const container = document.getElementById("invoiceDetails");
      let total = 0;

      let html = `
        <div class="invoice">
          <h2>📄 فاتورة ${invoice.clientName}</h2>
          <p><strong>📍 الموقع:</strong> ${invoice.location}</p>
          <p><strong>🕒 الحالة:</strong> ${invoice.status}</p>
          <table>
            <tr><th>المنتج</th><th>اللون</th><th>السعر</th></tr>
      `;

      invoice.products.forEach(p => {
        total += parseFloat(p.price);
        html += `<tr><td>${p.name}</td><td>${p.color}</td><td>${p.price} دج</td></tr>`;
      });

      html += `</table>
        <p><strong>💰 المجموع:</strong> ${total} دج</p>
      `;

      if (invoice.status !== "✅ تم التوصيل") {
        html += `<button class="btn" onclick="confirmDelivery(${invoice.id})">✅ تأكيد التسليم</button>`;
      } else {
        html += `<p style="color:green; text-align:center; font-weight:bold;">📦 تم تأكيد التوصيل</p>`;
      }

      html += `</div>`;

      container.innerHTML = html;
    }

    function confirmDelivery(id) {
      const index = invoices.findIndex(inv => inv.id === id);
      if (index !== -1) {
        invoices[index].status = "✅ تم التوصيل";
        localStorage.setItem("invoices", JSON.stringify(invoices));
        renderClientList();
        showInvoice(id);
      }
    }

    // بدء العرض
    renderClientList();
  </script>

</body>
</html>
