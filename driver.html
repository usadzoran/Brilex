<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ù„Ø³Ø§Ø¦Ù‚ - Brilex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      text-align: center;
      color: #28a745;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background-color: white;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 5px #ccc;
    }
    .invoice {
      background-color: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .btn {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
    }
    .delivered {
      background-color: #28a745;
    }
  </style>
</head>
<body>

  <h1>ğŸ“‹ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</h1>
  <div id="clientList"></div>
  <div id="invoiceDetails"></div>

  <script>
    const invoices = JSON.parse(localStorage.getItem("invoices") || "[]");

    function renderClientList() {
      const clientList = document.getElementById("clientList");
      if (invoices.length === 0) {
        clientList.innerHTML = "<p style='color:red; text-align:center;'>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø³Ø¬Ù„Ø©</p>";
        return;
      }

      let html = "<ul>";
      invoices.forEach((inv, i) => {
        html += `<li onclick="showInvoice(${inv.id})">ğŸ‘¤ ${inv.clientName} - ${inv.status}</li>`;
      });
      html += "</ul>";
      clientList.innerHTML = html;
    }

    function showInvoice(id) {
      const invoice = invoices.find(i => i.id === id);
      if (!invoice) return;

      const container = document.getElementById("invoiceDetails");
      let total = 0;

      let html = `
        <div class="invoice">
          <h2>ğŸ“„ ÙØ§ØªÙˆØ±Ø© ${invoice.clientName}</h2>
          <p><strong>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${invoice.location}</p>
          <p><strong>ğŸ•’ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${invoice.status}</p>
          <table>
            <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ù„ÙˆÙ†</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr>
      `;

      invoice.products.forEach(p => {
        total += parseFloat(p.price);
        html += `<tr><td>${p.name}</td><td>${p.color}</td><td>${p.price} Ø¯Ø¬</td></tr>`;
      });

      html += `</table>
        <p><strong>ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> ${total} Ø¯Ø¬</p>
      `;

      if (invoice.status !== "âœ… ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„") {
        html += `<button class="btn" onclick="confirmDelivery(${invoice.id})">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>`;
      } else {
        html += `<p style="color:green; text-align:center; font-weight:bold;">ğŸ“¦ ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</p>`;
      }

      html += `</div>`;

      container.innerHTML = html;
    }

    function confirmDelivery(id) {
      const index = invoices.findIndex(inv => inv.id === id);
      if (index !== -1) {
        invoices[index].status = "âœ… ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„";
        localStorage.setItem("invoices", JSON.stringify(invoices));
        renderClientList();
        showInvoice(id);
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
    renderClientList();
  </script>

</body>
</html>
